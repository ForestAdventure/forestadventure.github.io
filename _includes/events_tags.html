<section id="{{ section.section_id }}" class="events-section">
  <div class="container">
    {% if section.title %}
      <h2>{{ section.title }}</h2>
    {% endif %}

    <!--<div id="tag-filter-{{ section.section_id }}" class="tag-filter" style="margin: 1em 0;">
      <strong>Фильтр по тегам:</strong>
      <div class="tag-buttons" style="margin-top: 0.5em;"></div>
    </div>-->

    <ul class="events-list">
      {% for e in section.events %}
        <li class="event-item" data-tags="{{ e.tags | join: ',' }}">
          <strong><a href="{{ e.url | relative_url }}">{{ e.title }}</a></strong>
          {% if e.date %} — {{ e.date }}{% endif %}
          {% if e.place %}, {{ e.place }}{% endif %}
          <div class="tags">
            {% for tag in e.tags %}
              <span class="tag" style="background:#eee;padding:2px 5px;border-radius:4px;margin:2px;">{{ tag }}</span>
            {% endfor %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</section>

<!--<style>
.tag-buttons button {
  margin: 3px;
  padding: 5px 10px;
  border: 1px solid #ccc;
  background: #f8f8f8;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}
.tag-buttons button.active {
  background: #007bff;
  color: white;
  border-color: #007bff;
  transform: translateY(1px);
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const sectionId = "{{ section.section_id }}";
  const events = document.querySelectorAll(`#events-list-${sectionId} .event-item`);
  const buttonContainer = document.querySelector(`#tag-filter-${sectionId} .tag-buttons`);

  // Собираем все уникальные теги
  const allTags = new Set();
  events.forEach(event => {
    event.dataset.tags.split(",").forEach(tag => allTags.add(tag.trim()));
  });

  // Создаем кнопки
  [...allTags].sort().forEach(tag => {
    const button = document.createElement("button");
    button.textContent = tag;
    button.dataset.tag = tag;
    button.addEventListener("click", function() {
      this.classList.toggle("active");
      filterEvents();
    });
    buttonContainer.appendChild(button);
  });

  function filterEvents() {
    const selectedTags = [...buttonContainer.querySelectorAll(".active")].map(b => b.dataset.tag);
    events.forEach(event => {
      const tags = event.dataset.tags.split(",");
      const match = selectedTags.every(tag => tags.includes(tag));
      event.style.display = selectedTags.length === 0 || match ? "" : "none";
    });
  }
});
</script>
-->


